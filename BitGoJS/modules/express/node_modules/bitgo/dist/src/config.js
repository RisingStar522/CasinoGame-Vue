"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var _ = require("lodash");
var environments_1 = require("./v2/environments");
var statics_1 = require("@bitgo/statics");
// Get the list of ERC-20 tokens from statics and format it properly
var formattedErc20Tokens = statics_1.coins.reduce(function (acc, coin) {
    if (coin instanceof statics_1.Erc20Coin) {
        acc.push({
            type: coin.name,
            coin: coin.network.type === statics_1.NetworkType.MAINNET ? 'eth' : 'teth',
            network: coin.network.type === statics_1.NetworkType.MAINNET ? 'Mainnet' : 'Testnet',
            name: coin.fullName,
            tokenContractAddress: coin.contractAddress.toString().toLowerCase(),
            decimalPlaces: coin.decimalPlaces,
        });
    }
    return acc;
}, []);
// Get the list of Stellar tokens from statics and format it properly
var formattedStellarTokens = statics_1.coins.reduce(function (acc, coin) {
    if (coin instanceof statics_1.StellarCoin) {
        acc.push({
            type: coin.name,
            coin: coin.network.type === statics_1.NetworkType.MAINNET ? 'xlm' : 'txlm',
            network: coin.network.type === statics_1.NetworkType.MAINNET ? 'Mainnet' : 'Testnet',
            name: coin.fullName,
            decimalPlaces: coin.decimalPlaces,
        });
    }
    return acc;
}, []);
// Get the list of OFC tokens from statics and format it properly
var formattedOfcCoins = statics_1.coins.reduce(function (acc, coin) {
    if (coin instanceof statics_1.OfcCoin) {
        acc.push({
            type: coin.name,
            coin: 'ofc',
            backingCoin: coin.asset,
            name: coin.fullName,
            decimalPlaces: coin.decimalPlaces,
            isFiat: coin.kind === statics_1.CoinKind.FIAT,
        });
    }
    return acc;
}, []);
var formattedCeloTokens = statics_1.coins.reduce(function (acc, coin) {
    if (coin instanceof statics_1.CeloCoin) {
        acc.push({
            type: coin.name,
            coin: coin.network.type === statics_1.NetworkType.MAINNET ? 'celo' : 'tcelo',
            network: coin.network.type === statics_1.NetworkType.MAINNET ? 'Mainnet' : 'Testnet',
            name: coin.fullName,
            tokenContractAddress: coin.contractAddress.toString().toLowerCase(),
            decimalPlaces: coin.decimalPlaces,
        });
    }
    return acc;
}, []);
exports.tokens = {
    // network name for production environments
    bitcoin: {
        eth: {
            tokens: formattedErc20Tokens.filter(function (token) { return token.network === 'Mainnet'; }),
        },
        xlm: {
            tokens: formattedStellarTokens.filter(function (token) { return token.network === 'Mainnet'; }),
        },
        ofc: {
            tokens: formattedOfcCoins.filter(function (token) { return statics_1.coins.get(token.type).network.type === statics_1.NetworkType.MAINNET; }),
        },
        celo: {
            tokens: formattedCeloTokens.filter(function (token) { return token.network === 'Mainnet'; }),
        },
    },
    // network name for test environments
    testnet: {
        eth: {
            tokens: formattedErc20Tokens.filter(function (token) { return token.network === 'Testnet'; }),
        },
        xlm: {
            tokens: formattedStellarTokens.filter(function (token) { return token.network === 'Testnet'; }),
        },
        ofc: {
            tokens: formattedOfcCoins.filter(function (token) { return statics_1.coins.get(token.type).network.type === statics_1.NetworkType.TESTNET; }),
        },
        celo: {
            tokens: formattedCeloTokens.filter(function (token) { return token.network === 'Testnet'; }),
        },
    },
};
/**
 * Verify mainnet or testnet tokens
 * @param tokens
 */
var verifyTokens = function (tokens) {
    var verifiedTokens = {};
    _.forEach(tokens, function (token) {
        if (verifiedTokens[token.type]) {
            throw new Error('token : ' + token.type + ' duplicated.');
        }
        verifiedTokens[token.type] = true;
        if (token.tokenContractAddress && token.tokenContractAddress !== _.toLower(token.tokenContractAddress)) {
            throw new Error('token contract: ' + token.type + ' is not all lower case: ' + token.tokenContractAddress);
        }
    });
    return verifiedTokens;
};
var mainnetErc20Tokens = verifyTokens(exports.tokens.bitcoin.eth.tokens);
var mainnetStellarTokens = verifyTokens(exports.tokens.bitcoin.xlm.tokens);
exports.mainnetTokens = _.assign({}, mainnetErc20Tokens, mainnetStellarTokens);
var testnetErc20Tokens = verifyTokens(exports.tokens.testnet.eth.tokens);
var testnetStellarTokens = verifyTokens(exports.tokens.testnet.xlm.tokens);
exports.testnetTokens = _.assign({}, testnetErc20Tokens, testnetStellarTokens);
exports.defaults = {
    maxFee: 0.1e8,
    maxFeeRate: 1000000,
    minFeeRate: 5000,
    fallbackFeeRate: 50000,
    minOutputSize: 2730,
    minInstantFeeRate: 10000,
    bitgoEthAddress: '0x0f47ea803926926f299b7f1afc8460888d850f47'
};
// Supported cross-chain recovery routes. The coin to be recovered is the index, the valid coins for recipient wallets
// are listed in the array.
exports.supportedCrossChainRecoveries = {
    btc: ['bch', 'ltc', 'bsv'],
    bch: ['btc', 'ltc', 'bsv'],
    ltc: ['btc', 'bch', 'bsv'],
    bsv: ['btc', 'ltc', 'bch']
};
// KRS providers and their fee structures
exports.krsProviders = {
    keyternal: {
        feeType: 'flatUsd',
        feeAmount: 99,
        supportedCoins: ['btc', 'eth'],
        feeAddresses: {
            btc: '' // TODO [BG-6965] Get address from Keyternal - recovery will fail for now until Keyternal is ready
        }
    },
    bitgoKRSv2: {
        feeType: 'flatUsd',
        feeAmount: 0,
        supportedCoins: ['btc', 'eth']
    },
    dai: {
        feeType: 'flatUsd',
        feeAmount: 0,
        supportedCoins: ['btc', 'eth', 'xlm', 'xrp', 'dash', 'zec', 'ltc', 'bch']
    }
};
exports.coinGeckoBaseUrl = 'https://api.coingecko.com/api/v3/';
// TODO: once server starts returning eth address keychains, remove bitgoEthAddress
/**
 * Get the default (hardcoded) constants for a particular network.
 *
 * Note that this may not be the complete set of constants, and additional constants may get fetched
 * from BitGo during the lifespan of a BitGo object.
 * @param env
 */
exports.defaultConstants = function (env) {
    if (environments_1.Environments[env] === undefined) {
        throw Error("invalid environment " + env);
    }
    var network = environments_1.Environments[env].network;
    return _.merge({}, exports.defaults, exports.tokens[network]);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NvbmZpZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDBCQUE0QjtBQUM1QixrREFBa0U7QUFLbEUsMENBQXlHO0FBaUN6RyxvRUFBb0U7QUFDcEUsSUFBTSxvQkFBb0IsR0FBRyxlQUFLLENBQUMsTUFBTSxDQUFDLFVBQUMsR0FBdUIsRUFBRSxJQUFJO0lBQ3RFLElBQUksSUFBSSxZQUFZLG1CQUFTLEVBQUU7UUFDN0IsR0FBRyxDQUFDLElBQUksQ0FBQztZQUNQLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSTtZQUNmLElBQUksRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksS0FBSyxxQkFBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxNQUFNO1lBQ2hFLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksS0FBSyxxQkFBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxTQUFTO1lBQzFFLElBQUksRUFBRSxJQUFJLENBQUMsUUFBUTtZQUNuQixvQkFBb0IsRUFBRSxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsRUFBRSxDQUFDLFdBQVcsRUFBRTtZQUNuRSxhQUFhLEVBQUUsSUFBSSxDQUFDLGFBQWE7U0FDbEMsQ0FBQyxDQUFDO0tBQ0o7SUFDRCxPQUFPLEdBQUcsQ0FBQztBQUNiLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztBQUVQLHFFQUFxRTtBQUNyRSxJQUFNLHNCQUFzQixHQUFHLGVBQUssQ0FBQyxNQUFNLENBQUMsVUFBQyxHQUF5QixFQUFFLElBQUk7SUFDMUUsSUFBSSxJQUFJLFlBQVkscUJBQVcsRUFBRTtRQUMvQixHQUFHLENBQUMsSUFBSSxDQUFDO1lBQ1AsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO1lBQ2YsSUFBSSxFQUFFLElBQUksQ0FBQyxP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RTtRQUNuQyxNQUFNLEtBQUssQ0FBQyx5QkFBdUIsR0FBSyxDQUFDLENBQUM7S0FDM0M7SUFFRCxJQUFNLE9BQU8sR0FBRywyQkFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQztJQUMxQyxPQUFPLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLGdCQUFRLEVBQUUsY0FBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7QUFDaEQsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgRW52aXJvbm1lbnRzLCBFbnZpcm9ubWVudE5hbWUgfSBmcm9tICcuL3YyL2Vudmlyb25tZW50cyc7XG5pbXBvcnQgeyBPZmNUb2tlbkNvbmZpZyB9IGZyb20gJy4vdjIvY29pbnMvb2ZjVG9rZW4nO1xuaW1wb3J0IHsgRXJjMjBUb2tlbkNvbmZpZyB9IGZyb20gJy4vdjIvY29pbnMvZXJjMjBUb2tlbic7XG5pbXBvcnQgeyBTdGVsbGFyVG9rZW5Db25maWcgfSBmcm9tICcuL3YyL2NvaW5zL3N0ZWxsYXJUb2tlbic7XG5pbXBvcnQgeyBDZWxvVG9rZW5Db25maWcgfSBmcm9tICcuL3YyL2NvaW5zL2NlbG9Ub2tlbic7XG5pbXBvcnQgeyBjb2lucywgRXJjMjBDb2luLCBTdGVsbGFyQ29pbiwgT2ZjQ29pbiwgQ2Vsb0NvaW4sIENvaW5LaW5kLCBOZXR3b3JrVHlwZSB9IGZyb20gJ0BiaXRnby9zdGF0aWNzJztcblxuZXhwb3J0IGludGVyZmFjZSBUb2tlbnMge1xuICBiaXRjb2luOiB7XG4gICAgZXRoOiB7XG4gICAgICB0b2tlbnM6IEVyYzIwVG9rZW5Db25maWdbXTtcbiAgICB9O1xuICAgIHhsbToge1xuICAgICAgdG9rZW5zOiBTdGVsbGFyVG9rZW5Db25maWdbXTtcbiAgICB9O1xuICAgIG9mYzoge1xuICAgICAgdG9rZW5zOiBPZmNUb2tlbkNvbmZpZ1tdO1xuICAgIH07XG4gICAgY2Vsbzoge1xuICAgICAgdG9rZW5zOiBDZWxvVG9rZW5Db25maWdbXTtcbiAgICB9O1xuICB9O1xuICB0ZXN0bmV0OiB7XG4gICAgZXRoOiB7XG4gICAgICB0b2tlbnM6IEVyYzIwVG9rZW5Db25maWdbXTtcbiAgICB9O1xuICAgIHhsbToge1xuICAgICAgdG9rZW5zOiBTdGVsbGFyVG9rZW5Db25maWdbXTtcbiAgICB9O1xuICAgIG9mYzoge1xuICAgICAgdG9rZW5zOiBPZmNUb2tlbkNvbmZpZ1tdO1xuICAgIH07XG4gICAgY2Vsbzoge1xuICAgICAgdG9rZW5zOiBDZWxvVG9rZW5Db25maWdbXTtcbiAgICB9O1xuICB9O1xufVxuXG4vLyBHZXQgdGhlIGxpc3Qgb2YgRVJDLTIwIHRva2VucyBmcm9tIHN0YXRpY3MgYW5kIGZvcm1hdCBpdCBwcm9wZXJseVxuY29uc3QgZm9ybWF0dGVkRXJjMjBUb2tlbnMgPSBjb2lucy5yZWR1Y2UoKGFjYzogRXJjMjBUb2tlbkNvbmZpZ1tdLCBjb2luKSA9PiB7XG4gIGlmIChjb2luIGluc3RhbmNlb2YgRXJjMjBDb2luKSB7XG4gICAgYWNjLnB1c2goe1xuICAgICAgdHlwZTogY29pbi5uYW1lLFxuICAgICAgY29pbjogY29pbi5uZXR3b3JrLnR5cGUgPT09IE5ldHdvcmtUeXBlLk1BSU5ORVQgPyAnZXRoJyA6ICd0ZXRoJyxcbiAgICAgIG5ldHdvcms6IGNvaW4ubmV0d29yay50eXBlID09PSBOZXR3b3JrVHlwZS5NQUlOTkVUID8gJ01haW5uZXQnIDogJ1Rlc3RuZXQnLFxuICAgICAgbmFtZTogY29pbi5mdWxsTmFtZSxcbiAgICAgIHRva2VuQ29udHJhY3RBZGRyZXNzOiBjb2luLmNvbnRyYWN0QWRkcmVzcy50b1N0cmluZygpLnRvTG93ZXJDYXNlKCksXG4gICAgICBkZWNpbWFsUGxhY2VzOiBjb2luLmRlY2ltYWxQbGFjZXMsXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGFjYztcbn0sIFtdKTtcblxuLy8gR2V0IHRoZSBsaXN0IG9mIFN0ZWxsYXIgdG9rZW5zIGZyb20gc3RhdGljcyBhbmQgZm9ybWF0IGl0IHByb3Blcmx5XG5jb25zdCBmb3JtYXR0ZWRTdGVsbGFyVG9rZW5zID0gY29pbnMucmVkdWNlKChhY2M6IFN0ZWxsYXJUb2tlbkNvbmZpZ1tdLCBjb2luKSA9PiB7XG4gIGlmIChjb2luIGluc3RhbmNlb2YgU3RlbGxhckNvaW4pIHtcbiAgICBhY2MucHVzaCh7XG4gICAgICB0eXBlOiBjb2luLm5hbWUsXG4gICAgICBjb2luOiBjb2luLm5ldHdvcmsudHlwZSA9PT0gTmV0d29ya1R5cGUuTUFJTk5FVCA/ICd4bG0nIDogJ3R4bG0nLFxuICAgICAgbmV0d29yazogY29pbi5uZXR3b3JrLnR5cGUgPT09IE5ldHdvcmtUeXBlLk1BSU5ORVQgPyAnTWFpbm5ldCcgOiAnVGVzdG5ldCcsXG4gICAgICBuYW1lOiBjb2luLmZ1bGxOYW1lLFxuICAgICAgZGVjaW1hbFBsYWNlczogY29pbi5kZWNpbWFsUGxhY2VzLFxuICAgIH0pO1xuICB9XG4gIHJldHVybiBhY2M7XG59LCBbXSk7XG5cbi8vIEdldCB0aGUgbGlzdCBvZiBPRkMgdG9rZW5zIGZyb20gc3RhdGljcyBhbmQgZm9ybWF0IGl0IHByb3Blcmx5XG5jb25zdCBmb3JtYXR0ZWRPZmNDb2lucyA9IGNvaW5zLnJlZHVjZSgoYWNjOiBPZmNUb2tlbkNvbmZpZ1tdLCBjb2luKSA9PiB7XG4gIGlmIChjb2luIGluc3RhbmNlb2YgT2ZjQ29pbikge1xuICAgIGFjYy5wdXNoKHtcbiAgICAgIHR5cGU6IGNvaW4ubmFtZSxcbiAgICAgIGNvaW46ICdvZmMnLFxuICAgICAgYmFja2luZ0NvaW46IGNvaW4uYXNzZXQsXG4gICAgICBuYW1lOiBjb2luLmZ1bGxOYW1lLFxuICAgICAgZGVjaW1hbFBsYWNlczogY29pbi5kZWNpbWFsUGxhY2VzLFxuICAgICAgaXNGaWF0OiBjb2luLmtpbmQgPT09IENvaW5LaW5kLkZJQVQsXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGFjYztcbn0sIFtdKTtcblxuY29uc3QgZm9ybWF0dGVkQ2Vsb1Rva2VucyA9IGNvaW5zLnJlZHVjZSgoYWNjOiBDZWxvVG9rZW5Db25maWdbXSwgY29pbikgPT4ge1xuICBpZiAoY29pbiBpbnN0YW5jZW9mIENlbG9Db2luKSB7XG4gICAgYWNjLnB1c2goe1xuICAgICAgdHlwZTogY29pbi5uYW1lLFxuICAgICAgY29pbjogY29pbi5uZXR3b3JrLnR5cGUgPT09IE5ldHdvcmtUeXBlLk1BSU5ORVQgPyAnY2VsbycgOiAndGNlbG8nLFxuICAgICAgbmV0d29yazogY29pbi5uZXR3b3JrLnR5cGUgPT09IE5ldHdvcmtUeXBlLk1BSU5ORVQgPyAnTWFpbm5ldCcgOiAnVGVzdG5ldCcsXG4gICAgICBuYW1lOiBjb2luLmZ1bGxOYW1lLFxuICAgICAgdG9rZW5Db250cmFjdEFkZHJlc3M6IGNvaW4uY29udHJhY3RBZGRyZXNzLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSxcbiAgICAgIGRlY2ltYWxQbGFjZXM6IGNvaW4uZGVjaW1hbFBsYWNlcyxcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gYWNjO1xufSwgW10pO1xuXG5leHBvcnQgY29uc3QgdG9rZW5zOiBUb2tlbnMgPSB7XG4gIC8vIG5ldHdvcmsgbmFtZSBmb3IgcHJvZHVjdGlvbiBlbnZpcm9ubWVudHNcbiAgYml0Y29pbjoge1xuICAgIGV0aDoge1xuICAgICAgdG9rZW5zOiBmb3JtYXR0ZWRFcmMyMFRva2Vucy5maWx0ZXIodG9rZW4gPT4gdG9rZW4ubmV0d29yayA9PT0gJ01haW5uZXQnKSxcbiAgICB9LFxuICAgIHhsbToge1xuICAgICAgdG9rZW5zOiBmb3JtYXR0ZWRTdGVsbGFyVG9rZW5zLmZpbHRlcih0b2tlbiA9PiB0b2tlbi5uZXR3b3JrID09PSAnTWFpbm5ldCcpLFxuICAgIH0sXG4gICAgb2ZjOiB7XG4gICAgICB0b2tlbnM6IGZvcm1hdHRlZE9mY0NvaW5zLmZpbHRlcih0b2tlbiA9PiBjb2lucy5nZXQodG9rZW4udHlwZSkubmV0d29yay50eXBlID09PSBOZXR3b3JrVHlwZS5NQUlOTkVUKSxcbiAgICB9LFxuICAgIGNlbG86IHtcbiAgICAgIHRva2VuczogZm9ybWF0dGVkQ2Vsb1Rva2Vucy5maWx0ZXIodG9rZW4gPT4gdG9rZW4ubmV0d29yayA9PT0gJ01haW5uZXQnKSxcbiAgICB9LFxuICB9LFxuICAvLyBuZXR3b3JrIG5hbWUgZm9yIHRlc3QgZW52aXJvbm1lbnRzXG4gIHRlc3RuZXQ6IHtcbiAgICBldGg6IHtcbiAgICAgIHRva2VuczogZm9ybWF0dGVkRXJjMjBUb2tlbnMuZmlsdGVyKHRva2VuID0+IHRva2VuLm5ldHdvcmsgPT09ICdUZXN0bmV0JyksXG4gICAgfSxcbiAgICB4bG06IHtcbiAgICAgIHRva2VuczogZm9ybWF0dGVkU3RlbGxhclRva2Vucy5maWx0ZXIodG9rZW4gPT4gdG9rZW4ubmV0d29yayA9PT0gJ1Rlc3RuZXQnKSxcbiAgICB9LFxuICAgIG9mYzoge1xuICAgICAgdG9rZW5zOiBmb3JtYXR0ZWRPZmNDb2lucy5maWx0ZXIodG9rZW4gPT4gY29pbnMuZ2V0KHRva2VuLnR5cGUpLm5ldHdvcmsudHlwZSA9PT0gTmV0d29ya1R5cGUuVEVTVE5FVCksXG4gICAgfSxcbiAgICBjZWxvOiB7XG4gICAgICB0b2tlbnM6IGZvcm1hdHRlZENlbG9Ub2tlbnMuZmlsdGVyKHRva2VuID0+IHRva2VuLm5ldHdvcmsgPT09ICdUZXN0bmV0JyksXG4gICAgfSxcbiAgfSxcbn07XG5cbi8qKlxuICogVmVyaWZ5IG1haW5uZXQgb3IgdGVzdG5ldCB0b2tlbnNcbiAqIEBwYXJhbSB0b2tlbnNcbiAqL1xuY29uc3QgdmVyaWZ5VG9rZW5zID0gZnVuY3Rpb24odG9rZW5zKSB7XG4gIGNvbnN0IHZlcmlmaWVkVG9rZW5zID0ge307XG4gIF8uZm9yRWFjaCh0b2tlbnMsIGZ1bmN0aW9uKHRva2VuKSB7XG4gICAgaWYgKHZlcmlmaWVkVG9rZW5zW3Rva2VuLnR5cGVdKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3Rva2VuIDogJyArIHRva2VuLnR5cGUgKyAnIGR1cGxpY2F0ZWQuJyk7XG4gICAgfVxuICAgIHZlcmlmaWVkVG9rZW5zW3Rva2VuLnR5cGVdID0gdHJ1ZTtcblxuICAgIGlmICh0b2tlbi50b2tlbkNvbnRyYWN0QWRkcmVzcyAmJiB0b2tlbi50b2tlbkNvbnRyYWN0QWRkcmVzcyAhPT0gXy50b0xvd2VyKHRva2VuLnRva2VuQ29udHJhY3RBZGRyZXNzKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCd0b2tlbiBjb250cmFjdDogJyArIHRva2VuLnR5cGUgKyAnIGlzIG5vdCBhbGwgbG93ZXIgY2FzZTogJyArIHRva2VuLnRva2VuQ29udHJhY3RBZGRyZXNzKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gdmVyaWZpZWRUb2tlbnM7XG59O1xuXG5jb25zdCBtYWlubmV0RXJjMjBUb2tlbnMgPSB2ZXJpZnlUb2tlbnModG9rZW5zLmJpdGNvaW4uZXRoLnRva2Vucyk7XG5jb25zdCBtYWlubmV0U3RlbGxhclRva2VucyA9IHZlcmlmeVRva2Vucyh0b2tlbnMuYml0Y29pbi54bG0udG9rZW5zKTtcbmV4cG9ydCBjb25zdCBtYWlubmV0VG9rZW5zID0gXy5hc3NpZ24oe30sIG1haW5uZXRFcmMyMFRva2VucywgbWFpbm5ldFN0ZWxsYXJUb2tlbnMpO1xuXG5jb25zdCB0ZXN0bmV0RXJjMjBUb2tlbnMgPSB2ZXJpZnlUb2tlbnModG9rZW5zLnRlc3RuZXQuZXRoLnRva2Vucyk7XG5jb25zdCB0ZXN0bmV0U3RlbGxhclRva2VucyA9IHZlcmlmeVRva2Vucyh0b2tlbnMudGVzdG5ldC54bG0udG9rZW5zKTtcbmV4cG9ydCBjb25zdCB0ZXN0bmV0VG9rZW5zID0gXy5hc3NpZ24oe30sIHRlc3RuZXRFcmMyMFRva2VucywgdGVzdG5ldFN0ZWxsYXJUb2tlbnMpO1xuXG5cbmV4cG9ydCBjb25zdCBkZWZhdWx0cyA9IHtcbiAgbWF4RmVlOiAwLjFlOCxcbiAgbWF4RmVlUmF0ZTogMTAwMDAwMCxcbiAgbWluRmVlUmF0ZTogNTAwMCxcbiAgZmFsbGJhY2tGZWVSYXRlOiA1MDAwMCxcbiAgbWluT3V0cHV0U2l6ZTogMjczMCxcbiAgbWluSW5zdGFudEZlZVJhdGU6IDEwMDAwLFxuICBiaXRnb0V0aEFkZHJlc3M6ICcweDBmNDdlYTgwMzkyNjkyNmYyOTliN2YxYWZjODQ2MDg4OGQ4NTBmNDcnXG59O1xuXG4vLyBTdXBwb3J0ZWQgY3Jvc3MtY2hhaW4gcmVjb3Zlcnkgcm91dGVzLiBUaGUgY29pbiB0byBiZSByZWNvdmVyZWQgaXMgdGhlIGluZGV4LCB0aGUgdmFsaWQgY29pbnMgZm9yIHJlY2lwaWVudCB3YWxsZXRzXG4vLyBhcmUgbGlzdGVkIGluIHRoZSBhcnJheS5cbmV4cG9ydCBjb25zdCBzdXBwb3J0ZWRDcm9zc0NoYWluUmVjb3ZlcmllcyA9IHtcbiAgYnRjOiBbJ2JjaCcsICdsdGMnLCAnYnN2J10sXG4gIGJjaDogWydidGMnLCAnbHRjJywgJ2JzdiddLFxuICBsdGM6IFsnYnRjJywgJ2JjaCcsICdic3YnXSxcbiAgYnN2OiBbJ2J0YycsICdsdGMnLCAnYmNoJ11cbn07XG5cbi8vIEtSUyBwcm92aWRlcnMgYW5kIHRoZWlyIGZlZSBzdHJ1Y3R1cmVzXG5leHBvcnQgY29uc3Qga3JzUHJvdmlkZXJzID0ge1xuICBrZXl0ZXJuYWw6IHtcbiAgICBmZWVUeXBlOiAnZmxhdFVzZCcsXG4gICAgZmVlQW1vdW50OiA5OSxcbiAgICBzdXBwb3J0ZWRDb2luczogWydidGMnLCAnZXRoJ10sXG4gICAgZmVlQWRkcmVzc2VzOiB7XG4gICAgICBidGM6ICcnIC8vIFRPRE8gW0JHLTY5NjVdIEdldCBhZGRyZXNzIGZyb20gS2V5dGVybmFsIC0gcmVjb3Zlcnkgd2lsbCBmYWlsIGZvciBub3cgdW50aWwgS2V5dGVybmFsIGlzIHJlYWR5XG4gICAgfVxuICB9LFxuICBiaXRnb0tSU3YyOiB7XG4gICAgZmVlVHlwZTogJ2ZsYXRVc2QnLFxuICAgIGZlZUFtb3VudDogMCwgLy8gd2Ugd2lsbCByZWNlaXZlIHBheW1lbnRzIG9mZi1jaGFpblxuICAgIHN1cHBvcnRlZENvaW5zOiBbJ2J0YycsICdldGgnXVxuICB9LFxuICBkYWk6IHtcbiAgICBmZWVUeXBlOiAnZmxhdFVzZCcsXG4gICAgZmVlQW1vdW50OiAwLCAvLyBkYWkgd2lsbCByZWNlaXZlIHBheW1lbnRzIG9mZi1jaGFpblxuICAgIHN1cHBvcnRlZENvaW5zOiBbJ2J0YycsICdldGgnLCAneGxtJywgJ3hycCcsICdkYXNoJywgJ3plYycsICdsdGMnLCAnYmNoJ11cbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGNvaW5HZWNrb0Jhc2VVcmwgPSAnaHR0cHM6Ly9hcGkuY29pbmdlY2tvLmNvbS9hcGkvdjMvJztcblxuLy8gVE9ETzogb25jZSBzZXJ2ZXIgc3RhcnRzIHJldHVybmluZyBldGggYWRkcmVzcyBrZXljaGFpbnMsIHJlbW92ZSBiaXRnb0V0aEFkZHJlc3Ncbi8qKlxuICogR2V0IHRoZSBkZWZhdWx0IChoYXJkY29kZWQpIGNvbnN0YW50cyBmb3IgYSBwYXJ0aWN1bGFyIG5ldHdvcmsuXG4gKlxuICogTm90ZSB0aGF0IHRoaXMgbWF5IG5vdCBiZSB0aGUgY29tcGxldGUgc2V0IG9mIGNvbnN0YW50cywgYW5kIGFkZGl0aW9uYWwgY29uc3RhbnRzIG1heSBnZXQgZmV0Y2hlZFxuICogZnJvbSBCaXRHbyBkdXJpbmcgdGhlIGxpZmVzcGFuIG9mIGEgQml0R28gb2JqZWN0LlxuICogQHBhcmFtIGVudlxuICovXG5leHBvcnQgY29uc3QgZGVmYXVsdENvbnN0YW50cyA9IChlbnY6IEVudmlyb25tZW50TmFtZSkgPT4ge1xuICBpZiAoRW52aXJvbm1lbnRzW2Vudl0gPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IEVycm9yKGBpbnZhbGlkIGVudmlyb25tZW50ICR7ZW52fWApO1xuICB9XG5cbiAgY29uc3QgbmV0d29yayA9IEVudmlyb25tZW50c1tlbnZdLm5ldHdvcms7XG4gIHJldHVybiBfLm1lcmdlKHt9LCBkZWZhdWx0cywgdG9rZW5zW25ldHdvcmtdKTtcbn07XG4iXX0=